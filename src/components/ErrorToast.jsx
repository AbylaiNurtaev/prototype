import React, { useEffect, useState } from "react";
import styles from "./ErrorToast.module.scss";

const ErrorToast = ({ onClose, duration = 4000 }) => {
  const [progress, setProgress] = useState(0);

  useEffect(() => {
    const interval = duration / 100;
    const step = 100 / (duration / interval);

    const timer = setInterval(() => {
      setProgress((prev) => {
        const newProgress = prev + step;
        if (newProgress >= 100) {
          clearInterval(timer);
          onClose();
          return 100;
        }
        return newProgress;
      });
    }, interval);

    return () => clearInterval(timer);
  }, [duration, onClose]);

  return (
    <div className={styles.toast}>
      <div className={styles.toastContent}>
        <div className={styles.iconContainer}>
          <svg
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M12 1.5C14.7848 1.5 17.4555 2.60625 19.4246 4.57538C21.3938 6.54451 22.5 9.21523 22.5 12C22.5 14.7848 21.3938 17.4555 19.4246 19.4246C17.4555 21.3938 14.7848 22.5 12 22.5C9.21523 22.5 6.54451 21.3938 4.57538 19.4246C2.60625 17.4555 1.5 14.7848 1.5 12C1.5 9.21523 2.60625 6.54451 4.57538 4.57538C6.54451 2.60625 9.21523 1.5 12 1.5ZM12 6C11.8096 5.99983 11.6212 6.03938 11.4469 6.11613C11.2726 6.19288 11.1162 6.30514 10.9878 6.44573C10.8593 6.58633 10.7616 6.75217 10.7008 6.93267C10.6401 7.11317 10.6177 7.30435 10.635 7.494L11.1825 13.503C11.2037 13.705 11.299 13.892 11.45 14.028C11.6009 14.1639 11.7969 14.2391 12 14.2391C12.2031 14.2391 12.3991 14.1639 12.55 14.028C12.701 13.892 12.7963 13.705 12.8175 13.503L13.3635 7.494C13.3808 7.30447 13.3584 7.11342 13.2978 6.93303C13.2371 6.75263 13.1395 6.58686 13.0112 6.44629C12.8829 6.30572 12.7268 6.19343 12.5526 6.11659C12.3785 6.03975 12.1903 6.00004 12 6ZM12 18C12.3183 18 12.6235 17.8736 12.8485 17.6485C13.0736 17.4235 13.2 17.1183 13.2 16.8C13.2 16.4817 13.0736 16.1765 12.8485 15.9515C12.6235 15.7264 12.3183 15.6 12 15.6C11.6817 15.6 11.3765 15.7264 11.1515 15.9515C10.9264 16.1765 10.8 16.4817 10.8 16.8C10.8 17.1183 10.9264 17.4235 11.1515 17.6485C11.3765 17.8736 11.6817 18 12 18Z"
              fill="#CE5254"
            />
          </svg>
        </div>
        <div className={styles.text}>Неудачно, повторите попытку!</div>
        <button className={styles.closeButton} onClick={onClose}>
          <svg
            width="14"
            height="14"
            viewBox="0 0 14 14"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M6.575 7.975L1.675 12.875C1.49167 13.0583 1.25833 13.15 0.975 13.15C0.691667 13.15 0.458333 13.0583 0.275 12.875C0.0916663 12.6917 0 12.4583 0 12.175C0 11.8917 0.0916663 11.6583 0.275 11.475L5.175 6.575L0.275 1.675C0.0916663 1.49167 0 1.25833 0 0.975C0 0.691667 0.0916663 0.458333 0.275 0.275C0.458333 0.0916663 0.691667 0 0.975 0C1.25833 0 1.49167 0.0916663 1.675 0.275L6.575 5.175L11.475 0.275C11.6583 0.0916663 11.8917 0 12.175 0C12.4583 0 12.6917 0.0916663 12.875 0.275C13.0583 0.458333 13.15 0.691667 13.15 0.975C13.15 1.25833 13.0583 1.49167 12.875 1.675L7.975 6.575L12.875 11.475C13.0583 11.6583 13.15 11.8917 13.15 12.175C13.15 12.4583 13.0583 12.6917 12.875 12.875C12.6917 13.0583 12.4583 13.15 12.175 13.15C11.8917 13.15 11.6583 13.0583 11.475 12.875L6.575 7.975Z"
              fill="white"
            />
          </svg>
        </button>
      </div>
      <div className={styles.progressBar}>
        <div
          className={styles.progressFill}
          style={{ width: `${progress}%` }}
        />
      </div>
    </div>
  );
};

export default ErrorToast;

